<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="document_categories_list" name="Documents Categories">
        <t t-foreach="categories" t-as="c">
            <ul t-att-class="'nav flex-column nav-hierarchy mt-1 ps-3' if not is_search_bar else 'd-none' ">
                <div class="form-check d-inline-block">
                    <input
                        type="checkbox"
                        class="form-check-input doc-cat-checkbox"
                        name="category_ids"
                        t-att-id="'cat_%s' % c.id"
                        t-att-value="c.id"
                        t-att-checked="'checked' if c.id in selected_categories else None"/>
                    <label class="form-check-label fw-normal" t-att-for="'cat_%s' % c.id" t-esc="c.name"/>
                </div>
            </ul>
        </t>
    </template>

    <template
        id="website_search_box_input_inherite_carbongold_document_management"
        inherit_id="website.website_search_box_input"
        primary="True">
        <xpath expr="//form" position="inside">
            <input name="view_type" type="hidden" t-att-value="view_type"/>
            <t t-call="carbongold_document_management.document_categories_list">
                <t t-set="is_search_bar" t-value="true"/>
            </t>
        </xpath>
    </template>

    <template id="document_search" name="Search Box">
        <t t-call="carbongold_document_management.website_search_box_input_inherite_carbongold_document_management">
            <t t-set="_classes" t-valuef="px-3"/>
            <t t-set="_form_classes" t-valuef="o_wsale_products_searchbar_form me-auto flex-grow-1 d-lg-inline"/>
            <t t-set="_submit_classes" t-valuef="btn btn-light"/>
            <t t-set="_input_classes" t-valuef="border-0 text-bg-light"/>
            <t t-set="search_type" t-value="'document'"/>
            <t t-set="action" t-valuef="/documents"/>
            <t t-set="display_description" t-valuef="false"/>
            <t t-set="display_detail" t-valuef="false"/>
            <t t-set="display_image" t-valuef="true"/>
            <t t-set="view_type" t-value="view_type"/>
        </t>
    </template>

    <template id="document_add_grid_or_list_option" name="Grid or List button">
        <t t-set="_activeClasses" t-translation="off">btn-outline-primary</t>
        <div t-attf-class="o_wsale_apply_layout btn-group d-flex" t-att-data-active-classes="_activeClasses">
            <a t-att-href="'/documents?view_type=grid'">
                <button
                    type="button"
                    t-attf-class="btn #{_activeClasses if view_type != 'list' else None} o_wsale_apply_grid">
                    <i class="fa fa-th-large"/>
                </button>
            </a>
            <a t-att-href="'/documents?view_type=list'">
                <button
                    type="button"
                    t-attf-class="btn #{_activeClasses if view_type == 'list' else None} o_wsale_apply_list">
                    <i class="oi oi-view-list"/>
                </button>
            </a>
        </div>
    </template>

    <template id="all_documents" name="All Documents">
        <t t-call="website.layout">
            <div id="wrap" class="o_wsale_products_page">
                <div class="container pt-2">
                    <div class="row o_wsale_products_main_row align-items-start flex-nowrap">
                        <aside class="d-none d-lg-block position-sticky col-3 px-3 clearfix">
                            <div class="products_categories mb-3 mt-4">
                                <h6 class="o_categories_collapse_title mb-3"><b>Categories</b></h6>
                                <div class="wsale_products_categories_list">
                                    <form id="doc_category_form" method="get" action="/documents">
                                        <t t-call="carbongold_document_management.document_categories_list"/>
                                        <input type="hidden" name="search" t-att-value="search"/>
                                        <input type="hidden" name="view_type" t-att-value="view_type"/>
                                    </form>
                                </div>
                            </div>
                        </aside>

                        <div
                            id="documents_grid"
                            t-attf-class="col-lg-9 #{'o_wsale_layout_list' if view_type == 'list' else ''}">
                            <div
                                class="products_header btn-toolbar flex-nowrap align-items-center justify-content-between gap-3 mb-3">
                                <t t-call="carbongold_document_management.document_search">
                                    <t t-set="search" t-value="search"/>
                                </t>
                                <t t-call="carbongold_document_management.document_add_grid_or_list_option"/>
                            </div>

                            <div t-if="documents" class="pt-3 pt-lg-0">
                                <!-- List View -->
                                <div t-if="view_type=='list'" class="list-group">
                                    <t t-foreach="documents" t-as="doc">
                                        <div
                                            t-attf-onclick="location.href='/document/#{doc.name}/#{doc.id}';"
                                            style="cursor: pointer;"
                                            class="list-group-item list-group-item-action d-flex align-items-start gap-3 p-3">
                                            <img
                                                t-if="doc.thumbnail"
                                                t-att-src="'/web/image/documents.document/%s/thumbnail' % doc.id"
                                                class="rounded"
                                                style="width:80px; height:80px; object-fit:cover;"/>
                                            <img
                                                t-else=""
                                                t-att-src="'/base/static/img/avatar_grey.png'"
                                                class="rounded"
                                                style="width:80px; height:80px; object-fit:cover;"/>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1"><t
                                                        t-esc="doc.name[:80] + ('...' if len(doc.name) &gt; 80 else '')"/></h5>
                                                <span>
                                                    <t t-set="rating" t-value="int(doc.rating_avg or 0)"/>
                                                    <t t-foreach="range(5)" t-as="i">
                                                        <i
                                                            t-attf-class="#{'fa fa-star text-warning' if i &gt; rating else 'fa fa-star text-muted'}"/>
                                                    </t>
                                                </span>
                                                <small class="text-muted">
                                                    (<t t-esc="doc.rating_count or 0"/>)
                                                </small>
                                                <div t-if="doc.doc_description">
                                                    <small
                                                        class="text-muted"
                                                        t-esc="doc.doc_description[:250] + ('...' if len(doc.doc_description) &gt; 250 else '')"/>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>

                                <!-- Grid View -->
                                <div t-if="view_type=='grid'" class="row row-cols-1 row-cols-md-2 g-4">
                                    <t t-foreach="documents" t-as="doc">
                                        <div class="col">
                                            <div
                                                class="card h-100 shadow-sm border-0"
                                                style="cursor: pointer;"
                                                t-attf-onclick="location.href='/document/#{doc.name}/#{doc.id}';">
                                                <div class="card-body gap-3" style="max-height:195px;">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <img
                                                                t-if="doc.thumbnail"
                                                                t-att-src="'/web/image/documents.document/%s/thumbnail' % doc.id"
                                                                class="rounded"
                                                                style="width:80px; height:80px; object-fit:cover;"/>
                                                            <img
                                                                t-else=""
                                                                t-att-src="'/base/static/img/avatar_grey.png'"
                                                                class="rounded"
                                                                style="width:80px; height:80px; object-fit:cover;"/>
                                                        </div>
                                                        <div class="col-md-9">
                                                            <div class="align-items-center mb-1">
                                                                <h5 class="mb-0 fw-bold">
                                                                    <t
                                                                        t-esc="doc.name[:55] + ('...' if len(doc.name) &gt; 55 else '')"/>
                                                                </h5>
                                                                <span>
                                                                    <t
                                                                        t-set="rating"
                                                                        t-value="int(doc.rating_avg or 0)"/>
                                                                    <t t-foreach="range(5)" t-as="i">
                                                                        <i
                                                                            t-attf-class="#{'fa fa-star text-warning' if i &gt; rating else 'fa fa-star text-muted'}"/>
                                                                    </t>
                                                                </span>
                                                                <small class="text-muted">
                                                                    (<t t-esc="doc.rating_count or 0"/>)
                                                                </small>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <p class="text-muted mb-2 mt-3" t-if="doc.doc_description">
                                                                <t
                                                                    class="text-muted"
                                                                    t-esc="doc.doc_description[:150] + ('...' if len(doc.doc_description) &gt; 150 else '')"/>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <!-- No results -->
                            <div t-else="" class="text-center text-muted mt-5 mb-5">
                                <t t-if="not search">
                                    <h3>No documents available</h3>
                                    <p t-if="selected_categories">No documents in the selected categories.</p>
                                </t>
                                <t t-else="">
                                    <h3>No results</h3>
                                    <p>No results found for "<strong t-esc='search'/>".</p>
                                </t>
                            </div>

                            <!-- Pager -->
                            <div class="products_pager d-flex justify-content-center pt-5 pb-3">
                                <t t-call="website.pager"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="detail_document_page" name="Detail Document">
        <t t-call="website.layout">
            <section id="document_detail" class="container py-5">
                <div class="mb-4">
                    <ol class="breadcrumb p-0 mb-0 bg-transparent">
                        <li class="breadcrumb-item">
                            <a href="/documents">All Documents</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <t t-esc="document.name"/>
                        </li>
                    </ol>
                </div>
                <div class="row g-4 mt-4">
                    <div class="col-md-4 text-center">
                        <img
                            t-if="document.thumbnail"
                            t-att-src="'/web/image/documents.document/%s/thumbnail' % document.id"
                            class="img-fluid rounded shadow-sm"
                            style="height: 300px; width:400px; object-fit: cover;"/>
                        <img
                            t-else=""
                            t-att-src="'/base/static/img/avatar_grey.png'"
                            class="img-fluid rounded shadow-sm"
                            style="height: 300px; width:300px; object-fit: cover;"/>
                    </div>
                    <div class="col-md-8">
                        <h2 class="fw-bold mb-3">
                            <t t-esc="document.name"/>
                        </h2>
                        <div class="mb-3 d-flex align-items-center gap-2">
                            <t t-set="rating" t-value="int(document.rating_avg or 0)"/>
                            <t t-foreach="range(5)" t-as="i">
                                <i
                                    t-attf-class="#{'fa fa-star text-warning' if i &gt; rating else 'fa fa-star text-muted'}"/>
                            </t>
                            <small class="text-muted">
                                (<t t-esc="document.rating_count or 0"/> reviews)
                            </small>
                        </div>
                        <p class="mb-3">
                            <strong>Owner:</strong>
                            <span t-esc="document.owner_id.name"/>
                        </p>
                        <div class="mb-4"><p class="text-muted" t-esc="document.doc_description"/></div>

                        <div class="mb-4" t-if="document.datas">
                            <a t-att-href="'/document/download/%s' % document.id" class="btn btn-primary">
                                <i class="fa fa-download me-1"/> Download
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="shop_add_document_btn" inherit_id="carbongold_document_management.all_documents">
        <xpath expr="//div[@id='products_grid']/div" position="inside">
            <t t-if="not request.env.user._is_public()">
                <t t-call="upload_document" />
            </t>
        </xpath>
    </template>

    <template id="upload_document" name="Upload Document">
        <button type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#getDocumentModal">
            Upload Document
        </button>
        <div class="modal fade" id="getDocumentModal" tabindex="-1" aria-hidden="true" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content website-document">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Document</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close" />
                    </div>
                    <div class="modal-body">
                        <div class="form-label">
                            <label>Name of Document</label>
                            <input type="text" name="name" class="form-control" />
                        </div>
                        <div class="form-label">
                            <label>Author</label>
                            <input type="text" name="author" class="form-control" />
                        </div>
                        <div class="form-label">
                            <label>Description</label>
                            <textarea name="description" class="form-control" />
                        </div>
                        <div class="form-label">
                            <label>Category</label>
                            <select name="category" class="form-control">
                                <option value="">Select Category</option>
                                <t t-foreach="categories or []" t-as="category">
                                    <option t-att-value="category.id">
                                        <t t-esc="category.name" />
                                    </option>
                                </t>
                            </select>
                        </div>
                        <div class="form-label">
                            <label>Attachment Type</label>
                            <select name="attachment_type" class="form-control document-att-type">
                                <option value="file">File</option>
                                <option value="link">Link</option>
                            </select>
                        </div>
                        <div class="form-label">
                            <label>Attach Document</label>
                            <input type="file"
                                name="document_file"
                                class="form-control"
                                accept=".pdf,.doc,.docx,.pptx,.xls,.xlsx,.csv,.txt,.jpg,.jpeg,.png,.webp" />
                            <input type="text" name="document_link" class="form-control d-none"
                                placeholder="Enter link" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            Cancel</button>
                        <button type="button" class="btn btn-success saveDocumentBtn">Save Document</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

</odoo>
